<!DOCTYPE html>
<html>
<head>
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/combine/npm/tone@14.7.58,npm/@magenta/music@1.22.1/es6/core.js,npm/focus-visible@5,npm/html-midi-player@1.3.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script> 
  <script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script type='text/javascript' src='./src/js/jquery.particleground.js'></script>
  <script type='text/javascript' src='./src/js/sparticles.min.js'></script>
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
</head>
<body>
  
  <div id="app">
    <v-app>
        <template>
          <div class="sparticles-container" style="position: relative;width: 100%; height: 60rem;  max-height: 900px;">
            <v-app-bar 
              color="teal lighten-3" 
              :clipped-left="$vuetify.breakpoint.lgAndUp"
              app
              
            >
        
              <v-toolbar-title
                style="width: 430px"
              >
                <a href="/" class="white--text" style="text-decoration: none"><v-icon>mdi-music-circle</v-icon>&nbsp;Noname</a>
              </v-toolbar-title>
              
              
            </v-app-bar>
            <v-content>
              <v-bottom-navigation
                :value="activeBtn"
                color="primary"
                grow
              >
                <v-btn href="./index.html">
                  <span>{{url}}</span>
        
                  <v-icon>mdi-music-note</v-icon>
                </v-btn>
        
                <v-btn href="./player_test.html">
                  <span></span>
        
                  <v-icon>mdi-heart</v-icon>
                </v-btn>
        
              </v-bottom-navigation>
            </v-content>
            <!--div style="background-color:rgb(234, 233, 229)">
              <router-view/>
            </div-->
            
            <div >
              <v-layout align-content-center justify-center>
                <v-card width="60%" style="position: absolute; left: 20%; margin-top: 2rem;">
                  <v-app-bar
                  color="deep-purple accent-4"
                  dense
                  dark
                  >
                  
                  <v-toolbar-title>{{smf}}</v-toolbar-title>
                  
                  </v-app-bar>
                  <v-container>
                    <div class="row mb-3 d-flex justify-center">
                        
                        <span class="ma-1 mt-5">MODEL: </span>
                        
                        <v-col sm="5" class="pa-0"> 
                        <v-select
                            v-model="se"
                            :items="items"
                            item-text="genre"
                            item-value="id"
                            @change="select(se.id)"
                            label="Solo field"
                            return-object
                            solo
                            dense
                            class="mt-3 mr-2 ml-2 mb-n5 pa-0"
                        ></v-select>
                        </v-col>  
                        <v-btn 
                            rounded 
                            v-on:click="generate()"
                            class="ma-2 "
                            style="align-self:center"
                            
                        >
                            Generate
                        </v-btn>
                        
                    </div>
                    <v-divider ></v-divider>
                    <div class="mt-2 d-flex justify-center align-center">
                      <midi-player
                          :src= url
                          sound-font visualizer="#mainVisualizer" id="mainPlayer"
                      >
                      </midi-player>
                    </div>
                    <midi-visualizer type="piano-roll" id="mainVisualizer" 
                        :src= url>
                    </midi-visualizer>
                  
                  </v-container>
                </v-card>
              </v-layout>
            </div>
            
          </div>
          <v-footer
              :padless="true"
              style="position: absolute; bottom: -8rem;"
          >
            <v-card
              flat
              tile
              width="100%"
              class="secondary white--text text-center"
            >
        
              <v-card-text class="white--text pt-0">
                Phasellus feugiat arcu sapien, et iaculis ipsum elementum sit amet. Mauris cursus commodo interdum. Praesent ut risus eget metus luctus accumsan id ultrices nunc. Sed at orci sed massa consectetur dignissim a sit amet dui. Duis commodo vitae velit et faucibus.
              </v-card-text>
      
              <v-divider></v-divider>
      
              <v-card-text class="white--text">
                {{ new Date().getFullYear() }} — <strong>Noname</strong>
              </v-card-text>
            </v-card>
          </v-footer>
        </template>
    </v-app>
  </div>



  <script>
    //import player_test from './player_test.html';
    const player_test1 = { 
        template: 
        " <div> player_test </div> "
    }
    const music_generate = { template: '<div>music_generate</div>' }
    
    
    const routes = [
        { path: "/",component: player_test1},
        { path: "/music_generate", component: music_generate},

    ]
    


    // 3. 创建 router 实例，然后传 `routes` 配置
    const router = new VueRouter({
        mode: "history",
        routes // （缩写）相当于 routes: routes
    })

    
    
    new Vue({
      el: '#app',
      router,
      vuetify: new Vuetify(),
      components:[
         
      ],
      data() {
          return {
            se: {id:0, genre: 'rock & Pop'},
            items:[{id:0, genre: 'rock & Pop'}, {id:1, genre: 'Blue & Jezz'}, {id:2, genre: 'Country'}, {id:3, genre: 'metal'}],
            url: "./test.mid",
            smf: ""
          }
      },
      

      methods: {
        select: function(val){
          alert(val)
        },


        generate: function(){
            
            var bodyFormData = new FormData();
            //bodyFormData.append('email', this.myAccountId);
            //bodyFormData.append('password', this.myPassword);
            var config = {
                method: 'get',
                url: 'http://9d1f47828427.ngrok.io',
                headers: {
                          'Content-Type': "audio/midi",
                          'Access-Control-Allow-Origin': "*" },
                //data: bodyFormData,
                responseType: 'blob',
                
            };
            axios(config)
            .then((response) => {
                this.url = window.URL.createObjectURL(new Blob([response.data], { type: "audio/midi" }))
                /*this.url = window.URL.createObjectURL(new Blob([response.data], { type: response.data.type }));
                const link = document.createElement('a');
                link.href = this.url;
                link.setAttribute('download', 'file.mid');
                document.body.appendChild(link);
                link.click();*/
                alert("成功");

                
            })
            .catch((error) => {
                this.setTextFieldError(false, error);
                this.$refs.form.validate();
                alert("失敗")
            });
            
        },
      },

    })
  </script>
  <script>
    let container = document.querySelector(".sparticles-container");
    let mySparticles = new Sparticles( container, {"composition":"source-over",
      "count":544,
      "speed":10,
      "parallax":1,
      "direction":180,
      "xVariance":2,
      "yVariance":2,
      "rotate":true,
      "rotation":1,
      "alphaSpeed":10,
      "alphaVariance":1,
      "minAlpha":0,
      "maxAlpha":1,
      "minSize":1,
      "maxSize":32,
      "style":"fill",
      "bounce":false,
      "drift":1,
      "glow":0,
      "twinkle":false,
      "color":["random",
      "#ffffff"],
      "shape":"circle",});
  </script>
    
  <style>
    body { background: transparent; }
    html{ background-color: black; }
    .sparticles-container {
        
        /**
        * z-index: -1; this makes the <body> still interactive 
        * by placing the sparticles behind the content
        */
        /*pointer-events: none;*/
        /*z-index: 0;*/
        background-color: black;
    }
  </style>

</body>
</html>